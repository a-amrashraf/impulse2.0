{% comment %}
  Gift Wrapping Feature - Per-Item Only
  - Adds a checkbox for each product to enable individual item wrapping
  - Dynamically updates wrapping quantity based on checked items
{% endcomment %}

{% if settings.cart_wrapping_enable %}
  {% assign wrapping_handle = settings.cart_wrapping_product_handle | default: 'special-wrapping' %}
  {% assign wrappable_items = cart.items | where_exp: "item", "item.product.handle != wrapping_handle" %}
  
  <div class="cart-gift-wrapping" data-wrapping-container>
    <style>
      .cart-gift-wrapping {
        margin: 15px 0;
        padding: 15px;
        border: 1px solid var(--colorBorder);
        border-radius: 4px;
        background: var(--colorBody);
      }
      
      .wrapping-header {
        font-weight: 600;
        margin-bottom: 15px;
        font-size: {{ settings.cart_wrapping_font_size | default: 14 }}px;
        color: {{ settings.cart_wrapping_text_color | default: '#000000' }};
        {% if settings.cart_wrapping_font == 'header' %}
          font-family: var(--typeHeaderPrimary), var(--typeHeaderFallback);
        {% elsif settings.cart_wrapping_font == 'poppins' %}
          font-family: 'Poppins', sans-serif;
        {% else %}
          font-family: var(--typeBasePrimary), var(--typeBaseFallback);
        {% endif %}
      }
      
      .wrapping-item {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        padding: 12px;
        margin-bottom: 12px;
        border-radius: 4px;
        border: 1px solid var(--colorBorder);
        background-color: #fafafa;
      }
      
      .wrapping-item:hover {
        background-color: #f5f5f5;
      }
      
      .wrapping-checkbox {
        width: 18px;
        height: 18px;
        margin-top: 2px;
        cursor: pointer;
        flex-shrink: 0;
      }
      
      .wrapping-item-content {
        flex: 1;
      }
      
      .wrapping-item-label {
        cursor: pointer;
        font-size: {{ settings.cart_wrapping_font_size | default: 14 }}px;
        color: {{ settings.cart_wrapping_text_color | default: '#000000' }};
        font-weight: 500;
        display: block;
        margin-bottom: 4px;
        {% if settings.cart_wrapping_font == 'header' %}
          font-family: var(--typeHeaderPrimary), var(--typeHeaderFallback);
        {% elsif settings.cart_wrapping_font == 'poppins' %}
          font-family: 'Poppins', sans-serif;
        {% else %}
          font-family: var(--typeBasePrimary), var(--typeBaseFallback);
        {% endif %}
      }
      
      .wrapping-item-title {
        font-size: 13px;
        color: #666;
      }
      
      .wrapping-item-image {
        width: 50px;
        height: 50px;
        object-fit: cover;
        border-radius: 3px;
        border: 1px solid var(--colorBorder);
      }
    </style>

    <div class="wrapping-header">üéÅ {{ settings.cart_wrapping_text | default: 'Add special gift wrapping' }}</div>
    
    {% if wrappable_items.size > 0 %}
      {% for item in wrappable_items %}
        <div class="wrapping-item" data-wrapping-item="{{ item.key }}">
          <input 
            type="checkbox" 
            class="wrapping-checkbox" 
            id="wrap-{{ item.key }}" 
            data-item-key="{{ item.key }}"
            data-item-quantity="{{ item.quantity }}"
          >
          <div class="wrapping-item-content">
            <label for="wrap-{{ item.key }}" class="wrapping-item-label">
              {{ settings.cart_wrapping_text | default: 'Special wrap' }}
            </label>
            <div class="wrapping-item-title">
              {{ item.product.title }}{% if item.quantity > 1 %} (√ó{{ item.quantity }}){% endif %}
            </div>
          </div>
          {% if item.image %}
            <img src="{{ item.image | img_url: '50x50' }}" alt="{{ item.title }}" class="wrapping-item-image">
          {% endif %}
        </div>
      {% endfor %}
    {% else %}
      <p style="color: #666; font-size: 13px;">No items to wrap</p>
    {% endif %}
  </div>
{% endif %}
